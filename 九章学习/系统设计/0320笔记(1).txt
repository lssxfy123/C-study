1.协同 办公

协同，多个人同时一起做事情

OA 办公系统
聊天（微信），字节 飞书，阿里 钉钉

为啥聊天算协同？
不是单单的聊天， 打卡，预定会议室，公司的资料，多人会议，视频
日常办公需要的功能都有，
云盘，百度网盘 -》 内部的办公网盘，存储资料

协调文档，飞书，语雀



2.粒度(Granularity)

系统设计中 是一个非常重要的概念

 问题空间的大小

  文档
    段落
      句子
        词

    段

在修改一个东西，其他也在同时修改，”冲突“

”粒度“的考量


”粒度“越大，并发性越低

”粒度“越小，复杂性越高，产生的问题也就越多


3.LinkedHashmap 算法很重要

4.定时任务


每隔X时间执行一次

指定在 X时间点执行


5.不是只需要preid就可以插入新的行吗？需要afterid吗？



6.如果文件名称改变，DB更改名字，redis需要修改file key吗？还是只有row 改变才会改变redis内容？
 文件名称改变，但是文件ID是不变的，
 redis file key采用 文件ID，不用改了

7.请问基于行的架构，我可以修改选中字符的颜色么？
可以修改

8.什么是一行的标准？
 每个编辑器是不一的


9.第35页，redis那里，左边和右边分别指的什么数据，刚才没明白


文件的 头，尾 方便快速定位

    Key: file key + row key 存储某一行的数据


10.请问在文件系统里面我们是怎么存储这个linkedhashmap的？是直接serialize吗？

linkedhashmap 不存在 文件系统里

 服务器的内存中

 文件 文件系统 磁盘上


11.对于某一行怎么样算“操作完”啊？是出现长时间停顿吗？

12.od算法有没有具体的实现？

不建议大家花时间

13.前面那个关于行的问题，如果按回车键分行的话，那粒度不就其实是段落？

14.万一在感知其他client的操作之前就把update发给其他client了呢？
OT  会记录 每个客户端的状态，会根据你当前客户端的值进行命令转化的


15.老师可以把这个题用4S分析法分析一下吗？

场景： 协同编辑 ，功能
服务：同步服务，更改文件，创建文件，删除
存储： Redis,数据库里的表
优化扩展：锁定，”词“粒度，多人同时编制的展示



16.第一个client打开一个file会发生什么操作？

URL——》文件系统中找个找个文件（磁盘）-》服务内存中去



17.
  我要去买瓜

  我 ： 我要去买哈密瓜
  江畔： 我要去买西瓜

我要去买哈密西瓜

可能出现，我要去买哈西密瓜吗？


18.如果有多个web server呢，如何进行时间的同步？

 文档路由到同一个台server中去，在其他机器上也有备份（冗余）

19.能大概估计一下google doc级别的产品需要redis的最大存储空间嘛？
 推特  Redis  4万台
 google doc    8000-1万 Redis

20.当我们修改文档的时候，是多频繁的更新Redis呢？应该不，比如我在现有文件的第三行中间加入几个字，通常也是一个定时更新（比如每5秒更新一下Redis），还是会track键盘响应，比如超过5秒打字，才认为本次“微操作”完成，来更新Redis？

12345   (30S )


21.老师，请问按照现在的设计，超链接，图片，表格，公式怎么处理呢？

公式超链接 ,和普通一样

图片，文件服务器URL


表格

2*2  转换成二维坐标存储

（0，0）啊
（0，1）1
二维坐标的key，是hash行和列还是什么啊？

————
| (0,0)|(0,1) |
—— ——
| (1,0)|(1,1)  |
_   _
22.为什么在redis里面需要存linkedlist的tail？

文章的在哪里结尾

23.当用户在改动文档的时候 前端是按照什么速度把改动传到redis呢？ 比如用户新增一句话 但是user是一个字符一个字符打印出来的 那么是一个字符一个update吗 还是整一句话 或者user copy paste了一大段

一整段


24.如果insert('O', 0) 先到server 被执行了 那么insert('X', 3) 不就不对了吗 OT怎么判断这个insert('X', 3)是就是user要插入第三位 还是conflict了 需要改动呢

同时才会有问题

25.关于第一个人打开文件时，是否也需要在把文件内容load到内存后，也生成 LinkedHashList存到Redis啊？还是说Redis只存储发生修改的那些操作？
只存储发送改变的

26.修改内容除了时间顺序，有逻辑顺序吗？例如增加需要在删除之前之类的
没有逻辑顺序
只看时间


27.那是我们修改文档时，是实时改动web server上面的内存里面的数据结构，然后web server大概每30秒/或者光标移动时向Redis更新一下吗
客户端请求到服务器后，服务器 实时去传给其他客户端



28.如果一个人在第五行后面加了一行的时候，另外一个人在改第六行。虽然是两个行，但是增加了一行，代表着后面行要后移。
且增加一行后，第六行变第七行，第七行指向新的第六行。那这一串命令的顺序是什么？

clientA:
5 add line 


clientB:

另外一个人在改第六行



28.可能出现，我要去买哈西密瓜吗？

29.内存里面存的是原文件，还是存的linkedhashmap？
linkedhashmap

30.如果一大段连续文字，在第n行增加字符，然后push后面的m行都发生改变了。这种情况是否需要发送m个更新到redis吗？还是只有1行的更新。
增加的

服务器，会去识别增加的行

31.服务器内存也存LinkedHashMap吗，还是LinkedHashMap只存在Redis里面

服务器内存也存LinkedHashMap

Redis中不存

32.行key按照什么逻辑生成的？看起来不是row number

UUID生成

不会重复


